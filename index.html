// ----------------------------
//     BOSS MONSTER
// ----------------------------
class Boss {
    constructor() {
        this.type = "boss";
        this.pathIndex = 0;
        const start = gridToPixel(path[0]);
        this.x = start.x;
        this.y = start.y;

        this.speed = 0.5;  // BOSS er langsommere
        this.hp = 500 + wave * 20;  // BOSS har mye mer helse
        this.maxHp = this.hp;
        this.color = "#ff0000";  // Rød farge for BOSS
        this.radius = 20;  // Større enn vanlige fiender
    }

    update() {
        const next = path[this.pathIndex + 1];
        if (!next) {
            lives--;
            this.hp = 0;
            return;
        }
        const target = gridToPixel(next);
        const dx = target.x - this.x;
        const dy = target.y - this.y;
        const dist = Math.hypot(dx, dy);

        if (dist < this.speed) {
            this.pathIndex++;
        } else {
            this.x += dx / dist * this.speed;
            this.y += dy / dist * this.speed;
        }
    }

    draw() {
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
        ctx.fill();

        // HP-bar
        const w = 40;
        const ratio = this.hp / this.maxHp;
        ctx.fillStyle = "#000";
        ctx.fillRect(this.x - w/2, this.y - this.radius - 8, w, 4);
        ctx.fillStyle = "#0f0";
        ctx.fillRect(this.x - w/2, this.y - this.radius - 8, w * ratio, 4);
    }
}

// ----------------------------
//     SPAWNER OPPLADING
// ----------------------------
function spawnEnemy() {
    let type = "normal";
    
    // Spawne Boss fra bølge 5
    if (wave >= 5 && Math.random() < 0.05) {  // 5% sjanse på Bossen
        enemies.push(new Boss());
        return;
    }

    const r = Math.random();
    if (r < 0.15 + wave * 0.01) type = "fast";     // flere raske fiender senere
    if (r > 0.85 - wave * 0.01) type = "strong";   // flere sterke fiender senere

    enemies.push(new Enemy(type));
}

// Oppdater `nextWave` funksjonen om nødvendig
function nextWave() {
    wave++;
    enemiesToSpawn = 10 + wave * 3;
    spawnTimer = 0;
}
